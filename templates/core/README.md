# VBAプロジェクト モジュール概要

最終更新日: 2025-1-27

このドキュメントは、VBAプロジェクト内の各モジュールの概要、依存関係、メソッド、およびその他の関連情報を提供します。
この情報は、AIアシスタントがプロジェクトの構造と機能を理解し、効率的に開発タスクを実行するのに役立ちます。

## 表記

- `[モジュール名]` : モジュール名
- `[概要]` : モジュールの簡潔な説明
- `[依存関係]` : 依存する他のモジュールやクラス、ライブラリのリスト（モジュール名、クラス名、ライブラリ名など）
- `[メソッド]` : モジュール内の主要なメソッドのリスト
  - `[メソッド名]` : メソッド名
    - `[説明]` : メソッドの機能の説明
    - `[引数]` : 引数のリスト（名前, データ型, 説明）
    - `[戻り値]` : 戻り値のデータ型と説明
- `[その他特記事項]` : モジュールの使用上の注意点や、将来的な変更予定など

## モジュール一覧

### 1. clsLogger

- **概要**: アプリケーションのログ記録を管理するメインクラス。様々な出力先（ファイル、データベース、イベントログ、コンソール）へのログ出力をサポートする。
- **依存関係**:
    - ILoggerSettings
    - IQueue
    - ILock
    - IPerformanceMonitor
    - FileLogger
    - DatabaseLogger
    - EventLogLogger
    - ConsoleLogger
    - ErrorInfo
    - modError
    - modStackTrace
    - clsPerformanceMonitor
    - QueueImpl
- **メソッド**:
    - `Configure(settings As ILoggerSettings, queue As IQueue, lock As ILock, performanceMonitor As IPerformanceMonitor)`:
      - 説明: ロガーの設定、キュー、ロック、パフォーマンスモニターを構成する。
      - 引数:
        - `settings`: ILoggerSettings, ロガー設定オブジェクト
        - `queue`: IQueue, ログキューオブジェクト
        - `lock`: ILock, ロックオブジェクト
        - `performanceMonitor`: IPerformanceMonitor, パフォーマンスモニターオブジェクト
      - 戻り値: なし
    - `SetLogger(destination As String, logger As ILogger)`:
      - 説明: 特定の出力先に対するロガーインスタンスを設定する。
      - 引数:
        - `destination`: String, 出力先名（"File", "Database", "EventLog", "Console"など）
        - `logger`: ILogger, ロガーインスタンス
      - 戻り値: なし
    - `ILogger_Log(moduleName As String, message As String, Optional errorCode As ErrorCode)`:
      - 説明: ログメッセージをキューに追加する。
      - 引数:
        - `moduleName`: String, モジュール名
        - `message`: String, ログメッセージ
        - `errorCode`: ErrorCode (Optional), エラーコード
      - 戻り値: なし
    - `ILogger_LogLevel`:
      - 説明: ログレベルの設定・取得
      - 引数:
        - `level` (Let時): LogLevel, ログレベル
      - 戻り値:
        - (Get時) LogLevel, 現在のログレベル
    - `ILogger_LogDestination`:
      - 説明: ログ出力先の設定・取得
      - 引数:
        - `destination` (Let時): LogDestination, ログ出力先
      - 戻り値:
        - (Get時) LogDestination, 現在のログ出力先
    - `InitializeLoggers()`:
      - 説明: 設定に基づいてロガーを初期化する
      - 引数: なし
      - 戻り値: なし
    - `ProcessLogQueue()`:
      - 説明: ログキューを処理し、各ロガーにログメッセージを渡す
      - 引数: なし
      - 戻り値: なし
    - `CreateLogger(destination As String)`:
      - 説明: 指定された出力先に対応するロガーオブジェクトを作成する
      - 引数:
        - `destination`: String, 出力先名（"File", "Database", "EventLog", "Console"など）
      - 戻り値: ILogger, 作成されたロガーオブジェクト
    - `StartWorkerThread()`:
      - 説明: ワーカースレッドを作成し、開始する
      - 引数: なし
      - 戻り値: なし
- **その他特記事項**:
    - テスト用の内部メソッド（`GetQueueCount`, `ClearQueue`, `GetPerformanceMonitor`, `SimulateTimer`）は本番環境では使用しないこと。
    - `ProcessLogQueue` メソッドはタイマーによって定期的に呼び出され、ログキューからメッセージを取り出して処理する。
    - `EMERGENCY_LOG_PATH` 定数で指定されたパスに緊急時用のログファイルが出力される。
    - `Logged` イベントはログメッセージが処理された際に発生する。
    - `MAX_RETRY_COUNT` 定数でデータベースおよびイベントログへの書き込みリトライ回数を設定する。
    - `RETRY_DELAY_MS` 定数でデータベースおよびイベントログへの書き込みリトライ間隔を設定する。

### 2. clsPerformanceMonitor

- **概要**: パフォーマンス測定機能を提供するレガシークラス。時間計測、実行中の操作の記録、計測結果の取得、有効化・無効化などの機能を持つ。
- **依存関係**:
    - IPerformanceMonitor
    - PerformanceMonitorImpl
- **メソッド**:
    - `StartMeasurement(description As String)`:
      - 説明: パフォーマンス測定を開始する。
      - 引数:
        - `description`: String, 測定対象の説明
      - 戻り値: なし
    - `EndMeasurement(description As String)`:
      - 説明: パフォーマンス測定を終了する。
      - 引数:
        - `description`: String, 測定対象の説明
      - 戻り値: なし
    - `GetMeasurement(description As String)`:
      - 説明: 指定された測定対象の測定結果を取得する。
      - 引数:
        - `description`: String, 測定対象の説明
      - 戻り値: String, 測定結果の詳細情報
    - `GetAllMeasurements()`:
      - 説明: 全ての測定結果を取得する。
      - 引数: なし
      - 戻り値: String, 全ての測定結果を含むレポート
    - `ClearMeasurements()`:
      - 説明: 全ての測定結果をクリアする。
      - 引数: なし
      - 戻り値: なし
- **その他特記事項**:
    - 新規実装では `IPerformanceMonitor` インターフェースを使用することを推奨。
    - `IsEnabled` プロパティでパフォーマンス監視の有効・無効を切り替え可能。
    - `CurrentOperation` プロパティで現在実行中の操作を取得可能。

### 3. ConfigImpl

- **概要**: アプリケーション設定とデータベース設定を管理するクラス。INIファイルから設定を読み込み、保存する機能を提供する。
- **依存関係**:
    - IAppConfig
    - IDatabaseConfig
    - IIniFile
    - IniFileImpl
    - clsLock
    - IConnectionStringBuilder
    - ODBCConnectionStringBuilder
    - OLEDBConnectionStringBuilder
- **メソッド**:
    - `IAppConfig_GetSetting(settingName As String)`:
      - 説明: 指定された設定名の値を取得する。
      - 引数:
        - `settingName`: String, 設定名
      - 戻り値: Variant, 設定値。見つからない場合はNull。
    - `IAppConfig_SetSetting(settingName As String, settingValue As Variant)`:
      - 説明: 指定された設定名の値を設定する。
      - 引数:
        - `settingName`: String, 設定名
        - `settingValue`: Variant, 設定値
      - 戻り値: なし
    - `IAppConfig_LoadSettings(filePath As String)`:
      - 説明: 指定されたファイルから設定を読み込む。
      - 引数:
        - `filePath`: String, 設定ファイルのパス
      - 戻り値: なし
    - `IAppConfig_SaveSettings(filePath As String)`:
      - 説明: 指定されたファイルに設定を保存する。
      - 引数:
        - `filePath`: String, 設定ファイルのパス
      - 戻り値: なし
    - `IDatabaseConfig_GetConnectionString()`:
      - 説明: データベース接続文字列を取得する。
      - 引数: なし
      - 戻り値: String, データベース接続文字列
    - `IDatabaseConfig_GetDatabaseSetting(settingName As String)`:
      - 説明: 指定されたデータベース設定名の値を取得する。
      - 引数:
        - `settingName`: String, データベース設定名
      - 戻り値: Variant, データベース設定値。見つからない場合はNull。
    - `UpdateConnectionStringBuilder()`:
      - 説明: データベースタイプに基づいてConnectionStringBuilderを更新する。
      - 引数: なし
      - 戻り値: なし
- **その他特記事項**:
    - `AutoSave` プロパティが `True` の場合、設定変更時に自動的にファイルに保存される。
    - `mConnectionStringBuilder` は `IDatabaseConfig_DatabaseType` プロパティの値によって `ODBCConnectionStringBuilder` または `OLEDBConnectionStringBuilder` に切り替わる。

### 4. ConsoleLogger

- **概要**: コンソールへのログ出力を担当するクラス。
- **依存関係**:
    - ILogger
    - IPerformanceMonitor
    - ErrorInfo
    - modError
- **メソッド**:
    - `Initialize(performanceMonitor As IPerformanceMonitor, Optional useColors As Boolean = False)`:
      - 説明: ConsoleLoggerを初期化する。
      - 引数:
        - `performanceMonitor`: IPerformanceMonitor, パフォーマンスモニターオブジェクト
        - `useColors`: Boolean (Optional), 色付き出力を有効にするかどうか（デフォルトはFalse）
      - 戻り値: なし
    - `ILogger_Log(logLevel As String, message As String, Optional stackTrace As String, Optional errorCode As Long)`:
      - 説明: ログメッセージをコンソールに出力する。
      - 引数:
        - `logLevel`: String, ログレベル
        - `message`: String, ログメッセージ
        - `stackTrace`: String (Optional), スタックトレース
        - `errorCode`: Long (Optional), エラーコード
      - 戻り値: なし
- **その他特記事項**:
    - `mUseColors` が `True` の場合、ログレベルに応じて色付きで出力される。
    - ANSIエスケープシーケンスを使用して色を表現しているが、現状では定数が空文字で定義されているため、この機能は実質的に無効化されている。

### 5. DatabaseLogger

- **概要**: データベースへのログ出力を担当するクラス。
- **依存関係**:
    - ILogger
    - IConnectionPool
    - ILock
    - IPerformanceMonitor
    - IDatabaseConfig
    - ErrorInfo
    - modError
- **メソッド**:
    - `Initialize(connectionPool As IConnectionPool, lock As ILock, performanceMonitor As IPerformanceMonitor, databaseConfig As IDatabaseConfig, tableName As String)`:
      - 説明: DatabaseLoggerを初期化する。
      - 引数:
        - `connectionPool`: IConnectionPool, データベース接続プールオブジェクト
        - `lock`: ILock, ロックオブジェクト
        - `performanceMonitor`: IPerformanceMonitor, パフォーマンスモニターオブジェクト
        - `databaseConfig`: IDatabaseConfig, データベース設定オブジェクト
        - `tableName`: String, ログを保存するテーブル名
      - 戻り値: なし
    - `ILogger_Log(logLevel As String, message As String, Optional stackTrace As String, Optional errorCode As Long)`:
      - 説明: ログメッセージをデータベースに書き込む。
      - 引数:
        - `logLevel`: String, ログレベル
        - `message`: String, ログメッセージ
        - `stackTrace`: String (Optional), スタックトレース
        - `errorCode`: Long (Optional), エラーコード
      - 戻り値: なし
    - `WriteLogToDatabase(logLevel As String, message As String, stackTrace As String, errorCode As Long)`:
      - 説明: ログメッセージをデータベースに書き込む。(プライベートメソッド)
- 引数:
        - `logLevel`: String, ログレベル
        - `message`: String, ログメッセージ
        - `stackTrace`: String, スタックトレース
        - `errorCode`: Long, エラーコード
      - 戻り値: Boolean, 書き込みに成功したかどうか
- **その他特記事項**:
    - `MAX_RETRY_COUNT` 定数でデータベースへの書き込みリトライ回数を設定する。
    - `RETRY_DELAY_MS` 定数でデータベースへの書き込みリトライ間隔を設定する。
    - ログメッセージは `ADODB.Command` オブジェクトを使用してデータベースに挿入される。

### 6. DefaultLoggerSettings

- **概要**: ロガーのデフォルト設定を提供するクラス。
- **依存関係**:
    - ILoggerSettings
    - IAppConfig
    - IFileOperations
    - IConnectionPool
    - IEventLog
    - IDatabaseConfig
- **メソッド**:
    - `Initialize(appConfig As IAppConfig, fileOperations As IFileOperations, connectionPool As IConnectionPool, eventLog As IEventLog, databaseConfig As IDatabaseConfig)`:
      - 説明: DefaultLoggerSettingsを初期化する。
      - 引数:
        - `appConfig`: IAppConfig, アプリケーション設定オブジェクト
        - `fileOperations`: IFileOperations, ファイル操作オブジェクト
        - `connectionPool`: IConnectionPool, データベース接続プールオブジェクト
        - `eventLog`: IEventLog, イベントログオブジェクト
        - `databaseConfig`: IDatabaseConfig, データベース設定オブジェクト
      - 戻り値: なし
    - `ILoggerSettings_LogLevel`:
      - 説明: ログレベルの設定・取得
      - 引数:
        - `value` (Let時): LogLevel, ログレベル
      - 戻り値:
        - (Get時) LogLevel, 現在のログレベル
    - `ILoggerSettings_GetLogDestinations()`:
      - 説明: 有効なログ出力先のリストを取得する。
      - 引数: なし
      - 戻り値: Variant, ログ出力先の配列
    - `ILoggerSettings_LogFilePath`:
      - 説明: ログファイルのパスを取得する。
      - 引数: なし
      - 戻り値: String, ログファイルのパス
    - `ILoggerSettings_LogTableName`:
      - 説明: ログを保存するデータベースのテーブル名を取得する。
      - 引数: なし
      - 戻り値: String, テーブル名
    - `ILoggerSettings_LogEventSource`:
      - 説明: イベントログのソース名を取得する。
      - 引数: なし
      - 戻り値: String, イベントログのソース名
    - `ILoggerSettings_TimerInterval`:
      - 説明: タイマーの間隔を取得する。
      - 引数: なし
      - 戻り値: Long, タイマーの間隔（ミリ秒）
    - `ILoggerSettings_GetFileOperations()`:
      - 説明: ファイル操作オブジェクトを取得する。
      - 引数: なし
      - 戻り値: IFileOperations, ファイル操作オブジェクト
    - `ILoggerSettings_GetConnectionPool()`:
      - 説明: データベース接続プールオブジェクトを取得する。
      - 引数: なし
      - 戻り値: IConnectionPool, データベース接続プールオブジェクト
    - `ILoggerSettings_GetEventLog()`:
      - 説明: イベントログオブジェクトを取得する。
      - 引数: なし
      - 戻り値: IEventLog, イベントログオブジェクト
    - `ILoggerSettings_GetDatabaseConfig()`:
      - 説明: データベース設定オブジェクトを取得する。
      - 引数: なし
      - 戻り値: IDatabaseConfig, データベース設定オブジェクト
    - `ILoggerSettings_ShouldLog(destination As String, level As LogLevel)`:
      - 説明: 指定された出力先とログレベルでログを出力すべきかどうかを判定する。
      - 引数:
        - `destination`: String, 出力先名
        - `level`: LogLevel, ログレベル
      - 戻り値: Boolean, ログを出力すべきかどうか
    - `ILoggerSettings_FormatLogMessage(logLevel As String, message As String, stackTrace As String, errorCode As Long)`:
      - 説明: ログメッセージをフォーマットする。
      - 引数:
        - `logLevel`: String, ログレベル
        - `message`: String, メッセージ
        - `stackTrace`: String, スタックトレース
        - `errorCode`: Long, エラーコード
      - 戻り値: String, フォーマットされたログメッセージ
- **その他特記事項**:
    - `LoadSettings` メソッドで `IAppConfig` から設定を読み込む。
    - `ParseDestinations` メソッドで有効なログ出力先をパースする。

### 7. DefaultMessageFormatter

- **概要**: デフォルトのエラーメッセージフォーマットを提供するクラス。
- **依存関係**:
    - IMessageFormatter
    - ErrorInfo
    - modStackTrace
    - modError
- **メソッド**:
    - `IMessageFormatter_FormatMessage(message As String, ByRef errorInfo As ErrorInfo)`:
      - 説明: エラーメッセージをフォーマットする。
      - 引数:
        - `message`: String, メッセージ
        - `errorInfo`: ErrorInfo, エラー情報オブジェクト
      - 戻り値: String, フォーマットされたエラーメッセージ
- **その他特記事項**:
    - `FormatMessage` メソッドは、エラー情報オブジェクトの内容に基づいてエラーメッセージを組み立てる。
    - スタックトレースが存在する場合は、メッセージに追加される。
    - メッセージのフォーマット中にエラーが発生した場合は、エラーハンドラに処理を委譲する。
    - テスト用の `TestFormatMessage` メソッドを持つ（DEBUG時のみ）。

### 8. EmergencyLogger

- **概要**: 緊急時（エラーハンドラでエラーが発生した場合など）にログを出力するクラス。
- **依存関係**:
    - IEmergencyLogger
    - clsLock
    - modWindowsAPI
- **メソッド**:
    - `IEmergencyLogger_LogEmergencyError(message As String, Optional ByRef errorInfo As ErrorInfo)`:
      - 説明: 緊急エラーをログに記録する。
      - 引数:
        - `message`: String, エラーメッセージ
        - `errorInfo`: ErrorInfo (Optional), エラー情報オブジェクト
      - 戻り値: なし
    - `FormatErrorMessage(message As String, ByRef errorInfo As ErrorInfo)`:
      - 説明: エラーメッセージをフォーマットする。（プライベートメソッド）
      - 引数:
        - `message`: String, エラーメッセージ
        - `errorInfo`: ErrorInfo, エラー情報オブジェクト
      - 戻り値: String, フォーマットされたエラーメッセージ
    - `WriteToEventLog(message As String)`:
      - 説明: イベントログに書き込む。（プライベートメソッド）
      - 引数:
        - `message`: String, メッセージ
      - 戻り値: なし
    - `WriteToEmergencyFile(message As String)`:
      - 説明: 緊急用ファイルに書き込む。（プライベートメソッド）
      - 引数:
        - `message`: String, メッセージ
      - 戻り値: なし
- **その他特記事項**:
    - `EMERGENCY_LOG_FILE` 定数で緊急用ログファイルのパスを指定する。
    - `EVENT_SOURCE` 定数でイベントログのソース名を指定する。
    - テスト用の `GetEmergencyLogPath` および `ClearEmergencyLog` メソッドを持つ（DEBUG時のみ）。

### 9. ErrorHandlerManager

- **概要**: エラーハンドラーの登録・管理を行うクラス。
- **依存関係**:
    - IErrorHandler
    - clsLock
    - DatabaseConnectionErrorHandler
    - FileNotFoundErrorHandler
    - InvalidInputErrorHandler
    - modErrorCodes
- **メソッド**:
    - `InitializeManager()`:
      - 説明: エラーハンドラーマネージャーを初期化する。
      - 引数: なし
      - 戻り値: なし
    - `RegisterHandler(errorCode As ErrorCode, handler As IErrorHandler)`:
      - 説明: エラーコードに対応するエラーハンドラーを登録する。
      - 引数:
        - `errorCode`: ErrorCode, エラーコード
        - `handler`: IErrorHandler, エラーハンドラー
      - 戻り値: なし
    - `UnregisterHandler(errorCode As ErrorCode)`:
      - 説明: エラーコードに対応するエラーハンドラーの登録を解除する。
      - 引数:
        - `errorCode`: ErrorCode, エラーコード
      - 戻り値: なし
    - `GetErrorHandler(errorCode As ErrorCode)`:
      - 説明: エラーコードに対応するエラーハンドラーを取得する。
      - 引数:
        - `errorCode`: ErrorCode, エラーコード
      - 戻り値: IErrorHandler, エラーハンドラー
    - `RegisterDefaultHandlers()`:
      - 説明: デフォルトのエラーハンドラーを登録する。（プライベートメソッド）
      - 引数: なし
      - 戻り値: なし
    - `GetDefaultHandlerForCategory(category As ErrorCodeCategory)`:
      - 説明: エラーカテゴリに対応するデフォルトのエラーハンドラーを取得する。（プライベートメソッド）
      - 引数:
        - `category`: ErrorCodeCategory, エラーカテゴリ
      - 戻り値: IErrorHandler, デフォルトのエラーハンドラー
- **その他特記事項**:
    - `mHandlers` コレクションにエラーコードとエラーハンドラーのペアを保持する。
    - テスト用の `GetHandlerCount` および `ClearHandlers` メソッドを持つ（DEBUG時のみ）。

### 10. ErrorImpl

- **概要**: エラー処理の主機能を担当するクラス。エラーハンドラーの呼び出し、エラー情報の補完、エラー回数のカウントなどを行う。
- **依存関係**:
    - IError
    - ErrorHandlerManager
    - IEmergencyLogger
    - EmergencyLogger
    - clsLock
    - clsPerformanceMonitor
    - ErrorInfo
    - modErrorCodes
    - modStackTrace
- **メソッド**:
    - `IError_HandleError(ByRef errorInfo As ErrorInfo)`:
      - 説明: エラーを処理する。
      - 引数:
        - `errorInfo`: ErrorInfo, エラー情報オブジェクト
      - 戻り値: Boolean, エラー処理を続行するかどうか
    - `IError_RegisterHandler(errorCode As ErrorCode, handler As IErrorHandler)`:
      - 説明: エラーハンドラーを登録する。
      - 引数:
        - `errorCode`: ErrorCode, エラーコード
        - `handler`: IErrorHandler, エラーハンドラー
      - 戻り値: なし
    - `IError_UnregisterHandler(errorCode As ErrorCode)`:
      - 説明: エラーハンドラーの登録を解除する。
      - 引数:
        - `errorCode`: ErrorCode, エラーコード
      - 戻り値: なし
    - `IError_IncrementErrorCount(errorCode As ErrorCode)`:
      - 説明: エラーの発生回数をカウントする。
      - 引数:
        - `errorCode`: ErrorCode, エラーコード
      - 戻り値: なし
    - `IError_CheckErrorThreshold(errorCode As ErrorCode, threshold As Long)`:
      - 説明: エラーの発生回数が閾値を超えたかどうかをチェックする。
      - 引数:
        - `errorCode`: ErrorCode, エラーコード
        - `threshold`: Long, 閾値
      - 戻り値: Boolean, 閾値を超えたかどうか
    - `CompleteErrorInfo(ByRef errorInfo As ErrorInfo)`:
      - 説明: エラー情報オブジェクトの不足情報を補完する。（プライベートメソッド）
      - 引数:
        - `errorInfo`: ErrorInfo, エラー情報オブジェクト
      - 戻り値: なし
    - `RemoveOldestErrorCount()`:
      - 説明: エラーカウントの辞書から最も古いエントリを削除する。（プライベートメソッド）
      - 引数: なし
      - 戻り値: なし
- **その他特記事項**:
    - `MAX_ERROR_RECURSION` 定数でエラー処理の再帰呼び出しの上限回数を設定する。
    - `ERROR_COUNT_DICT_SIZE` 定数でエラーカウントを保持する辞書の最大サイズを設定する。
    - `mErrorCounts` 辞書にエラーコードごとの発生回数を記録する。
    - テスト用の `GetErrorCount`, `ClearErrorCounts`, `GetPerformanceReport` メソッドを持つ（DEBUG時のみ）。

### 11. ErrorInfo

- **概要**: エラー情報を格納するクラス。
- **依存関係**: なし
- **メソッド**:
    - `AddAdditionalInfo(key As String, value As Variant)`:
      - 説明: エラー情報に追加情報を追加する。
      - 引数:
        - `key`: String, 追加情報のキー
        - `value`: Variant, 追加情報の値
      - 戻り値: なし
    - `GetAdditionalInfo(key As String)`:
      - 説明: エラー情報から追加情報を取得する。
      - 引数:
        - `key`: String, 追加情報のキー
      - 戻り値: Variant, 追加情報の値
    - `HasAdditionalInfo(key As String)`:
      - 説明: エラー情報に追加情報が存在するかどうかを確認する。
      - 引数:
        - `key`: String, 追加情報のキー
      - 戻り値: Boolean, 追加情報が存在するかどうか
    - `Clone()`:
      - 説明: エラー情報オブジェクトのコピーを作成する。
      - 引数: なし
      - 戻り値: ErrorInfo, コピーされたエラー情報オブジェクト
    - `ToString()`:
      - 説明: エラー情報オブジェクトを文字列形式で返す。
      - 引数: なし
      - 戻り値: String, エラー情報の文字列表現
- **その他特記事項**:
    - `ErrorSeverity` 列挙型でエラーの重要度を定義する。
    - `mAdditionalInfo` コレクションに追加情報を格納する。

### 12. EventLogImpl

- **概要**: Windowsイベントログへの書き込みを担当するクラス。
- **依存関係**:
    - IEventLog
    - clsLock
    - clsPerformanceMonitor
    - modWindowsAPI
    - ErrorInfo
    - modError
    - modStackTrace
- **メソッド**:
    - `IEventLog_WriteToEventLog(source As String, message As String, eventType As EventLogType)`:
      - 説明: イベントログに書き込む。
      - 引数:
        - `source`: String, イベントソース
        - `message`: String, メッセージ
        - `eventType`: EventLogType, イベントの種類
      - 戻り値: Boolean, 書き込みに成功したかどうか
    - `IEventLog_EventSourceExists(source As String)`:
      - 説明: イベントソースが存在するかどうかを確認する。
      - 引数:
        - `source`: String, イベントソース
      - 戻り値: Boolean, イベントソースが存在するかどうか
    - `LogError(message As String)`:
      - 説明: エラーをログに記録する。（プライベートメソッド）
      - 引数:
        - `message`: String, エラーメッセージ
      - 戻り値: なし
- **その他特記事項**:
    - `LastError` プロパティで最後のエラーメッセージを取得できる。
    - テスト用の `ValidateState`, `GetPerformanceMonitor`, `TestEventLogAccess` メソッドを持つ（DEBUG時のみ）。

### 13. EventLogLogger

- **概要**: イベントログへのログ出力を担当するクラス。
- **依存関係**:
    - ILogger
    - IEventLog
    - ILock
    - IPerformanceMonitor
    - ErrorInfo
    - modError
- **メソッド**:
    - `Initialize(eventLog As IEventLog, lock As ILock, performanceMonitor As IPerformanceMonitor, eventSource As String)`:
      - 説明: EventLogLoggerを初期化する。
      - 引数:
        - `eventLog`: IEventLog, イベントログオブジェクト
        - `lock`: ILock, ロックオブジェクト
        - `performanceMonitor`: IPerformanceMonitor, パフォーマンスモニターオブジェクト
        - `eventSource`: String, イベントソース名
      - 戻り値: なし
    - `ILogger_Log(logLevel As String, message As String, Optional stackTrace As String, Optional errorCode As Long)`:
      - 説明: ログメッセージをイベントログに書き込む。
      - 引数:
        - `logLevel`: String, ログレベル
        - `message`: String, ログメッセージ
        - `stackTrace`: String (Optional), スタックトレース
        - `errorCode`: Long (Optional), エラーコード
      - 戻り値: なし
    - `WriteLogToEventLog(logLevel As String, message As String, stackTrace As String, errorCode As Long)`:
      - 説明: ログメッセージをイベントログに書き込む。（プライベートメソッド）
      - 引数:
        - `logLevel`: String, ログレベル
        - `message`: String, ログメッセージ
        - `stackTrace`: String, スタックトレース
        - `errorCode`: Long, エラーコード
      - 戻り値: Boolean, 書き込みに成功したかどうか
- **その他特記事項**:
    - `MAX_RETRY_COUNT` 定数でイベントログへの書き込みリトライ回数を設定する。
    - `RETRY_DELAY_MS` 定数でイベントログへの書き込みリトライ間隔を設定する。
    - ログレベルに応じてイベントの種類（`EVENTLOG_SUCCESS`, `EVENTLOG_ERROR`, `EVENTLOG_WARNING`, `EVENTLOG_INFORMATION`）を決定する。

### 14. FileLogger

- **概要**: ファイルへのログ出力を担当するクラス。
- **依存関係**:
    - ILogger
    - IFileOperations
    - ILock
    - IPerformanceMonitor
    - ErrorInfo
    - modError
- **メソッド**:
    - `Initialize(fileOperations As IFileOperations, lock As ILock, performanceMonitor As IPerformanceMonitor, logFilePath As String)`:
      - 説明: FileLoggerを初期化する。
      - 引数:
        - `fileOperations`: IFileOperations, ファイル操作オブジェクト
        - `lock`: ILock, ロックオブジェクト
        - `performanceMonitor`: IPerformanceMonitor, パフォーマンスモニターオブジェクト
        - `logFilePath`: String, ログファイルのパス
      - 戻り値: なし
    - `ILogger_Log(logLevel As String, message As String, Optional stackTrace As String, Optional errorCode As Long)`:
      - 説明: ログメッセージをファイルに書き込む。
      - 引数:
        - `logLevel`: String, ログレベル
        - `message`: String, ログメッセージ
        - `stackTrace`: String (Optional), スタックトレース
        - `errorCode`: Long (Optional), エラーコード
      - 戻り値: なし
    - `BuildLogMessage(logLevel As String, message As String, stackTrace As String, errorCode As Long)`:
      - 説明: ログメッセージを組み立てる。（プライベートメソッド）
      - 引数:
        - `logLevel`: String, ログレベル
        - `message`: String, ログメッセージ
        - `stackTrace`: String, スタックトレース
        - `errorCode`: Long, エラーコード
      - 戻り値: String, 組み立てられたログメッセージ
    - `WriteLogToFile(logMessage As String)`:
      - 説明: ログメッセージをファイルに書き込む。（プライベートメソッド）
      - 引数:
        - `logMessage`: String, ログメッセージ
      - 戻り値: Boolean, 書き込みに成功したかどうか
- **その他特記事項**:
    - `MAX_RETRY_COUNT` 定数でファイルへの書き込みリトライ回数を設定する。
    - `RETRY_DELAY_MS` 定数でファイルへの書き込みリトライ間隔を設定する。
    - ログファイルが存在しない場合は `CreateFile` メソッドで作成される。

### 15. InvalidInputErrorHandler

- **概要**: 不正な入力エラーを処理するエラーハンドラー。入力値の自動補正とユーザーへの通知を行う。
- **依存関係**:
    - IErrorHandler
    - ILock
    - ILogger
    - IEmergencyLogger
    - IUserNotifier
    - IValidator
    - ErrorInfo
    - modStackTrace
    - modError
- **メソッド**:
    - `Create(lock As ILock, logger As ILogger, emergencyLogger As IEmergencyLogger, userNotifier As IUserNotifier, validator As IValidator)`:
      - 説明: InvalidInputErrorHandlerのインスタンスを作成する。
      - 引数:
        - `lock`: ILock, ロックオブジェクト
        - `logger`: ILogger, ロガーオブジェクト
        - `emergencyLogger`: IEmergencyLogger, 緊急ロガーオブジェクト
        - `userNotifier`: IUserNotifier, ユーザー通知オブジェクト
        - `validator`: IValidator, 入力値検証オブジェクト
      - 戻り値: InvalidInputErrorHandler, InvalidInputErrorHandlerのインスタンス
    - `IErrorHandler_HandleError(ByRef errorDetail As ErrorInfo)`:
      - 説明: 不正な入力エラーを処理する。
      - 引数:
        - `errorDetail`: ErrorInfo, エラー情報
      - 戻り値: Boolean, エラー処理を続行するかどうか
    - `TryCorrectInput(value As Variant, inputType As String, ByRef correctedValue As Variant)`:
      - 説明: 入力値の自動補正を試みる。（プライベートメソッド）
      - 引数:
        - `value`: Variant, 入力値
        - `inputType`: String, 入力値の型
        - `correctedValue`: Variant, 補正後の値（出力用）
      - 戻り値: Boolean, 補正に成功したかどうか
    - `TryCorrectNumber(value As Variant, ByRef correctedValue As Variant)`:
      - 説明: 数値型の入力値の自動補正を試みる。（プライベートメソッド）
      - 引数:
        - `value`: Variant, 入力値
        - `correctedValue`: Variant, 補正後の値（出力用）
      - 戻り値: Boolean, 補正に成功したかどうか
    - `TryCorrectDate(value As Variant, ByRef correctedValue As Variant)`:
      - 説明: 日付型の入力値の自動補正を試みる。（プライベートメソッド）
      - 引数:
        - `value`: Variant, 入力値
        - `correctedValue`: Variant, 補正後の値（出力用）
      - 戻り値: Boolean, 補正に成功したかどうか
    - `TryCorrectString(value As Variant, ByRef correctedValue As Variant)`:
      - 説明: 文字列型の入力値の自動補正を試みる。（プライベートメソッド）
      - 引数:
        - `value`: Variant, 入力値
        - `correctedValue`: Variant, 補正後の値（出力用）
      - 戻り値: Boolean, 補正に成功したかどうか
    - `LogError(ByRef errorDetail As ErrorInfo)`:
      - 説明: エラーをログに記録する。（プライベートメソッド）
      - 引数:
        - `errorDetail`: ErrorInfo, エラー情報
      - 戻り値: なし
    - `NotifyUser(ByRef errorDetail As ErrorInfo, style As VbMsgBoxStyle)`:
      - 説明: ユーザーにエラーを通知する。（プライベートメソッド）
      - 引数:
        - `errorDetail`: ErrorInfo, エラー情報
        - `style`: VbMsgBoxStyle, メッセージボックスのスタイル
      - 戻り値: なし
- **その他特記事項**:
    - コンストラクタ `Create` を使用して、依存オブジェクトを注入する。
    - 入力値の型に応じて `TryCorrectNumber`, `TryCorrectDate`, `TryCorrectString`を使い分けて自動補正を試みる。
    - 自動補正に成功した場合は、エラー情報オブジェクトに `CorrectedValue` として補正後の値を追加する。
    - エラーの重要度が `ESError` 以上の場合、緊急ログにも記録する。

### 16. modAppInitializer

- **概要**: アプリケーションの初期化処理を担当するモジュール。
- **依存関係**:
    - modConfig
    - clsLogger
    - DefaultLoggerSettings
    - modDatabaseUtils
    - ConnectionPool
    - DatabaseConnectionErrorHandler
    - ErrorInfo
    - modError
    - modStackTrace
- **メソッド**:
    - `InitializeApplication()`:
      - 説明: アプリケーションを初期化する。
      - 引数: なし
      - 戻り値: なし
    - `InitializeLogging()`:
      - 説明: ロギングシステムを初期化する。（プライベートメソッド）
      - 引数: なし
      - 戻り値: なし
    - `InitializeDatabase()`:
      - 説明: データベース関連の初期化を行う。（プライベートメソッド）
      - 引数: なし
      - 戻り値: なし
    - `InitializeErrorHandlers()`:
      - 説明: エラーハンドラーを初期化する。（プライベートメソッド）
      - 引数: なし
      - 戻り値: なし
- **その他特記事項**:
    - `InitializationState` 型変数 `mInitState` で各コンポーネントの初期化状態を管理する。
    - `InitializeApplication` メソッドは、設定、ロギング、データベース、エラーハンドラーの順に初期化を行う。

### 17. modConfig

- **概要**: アプリケーションの設定を管理するモジュール。
- **依存関係**:
    - IDatabaseConfig
    - modWindowsAPI
    - clsLock
    - clsPerformanceMonitor
    - ErrorInfo
    - modError
    - clsCallStack
- **メソッド**:
    - `InitializeModule()`:
      - 説明: モジュールを初期化する。
      - 引数: なし
      - 戻り値: なし
    - `TerminateModule()`:
      - 説明: モジュールを終了処理する。
      - 引数: なし
      - 戻り値: なし
    - `GetConfigValue(section As String, key As String, Optional defaultValue As String = "")`:
      - 説明: 設定ファイルから値を取得する。
      - 引数:
        - `section`: String, セクション名
        - `key`: String, キー名
        - `defaultValue`: String (Optional), デフォルト値
      - 戻り値: String, 取得した値
    - `SetConfigValue(section As String, key As String, Value As String)`:
      - 説明: 設定ファイルに値を設定する。
      - 引数:
        - `section`: String, セクション名
        - `key`: String, キー名
        - `Value`: String, 設定値
      - 戻り値: Boolean, 設定に成功したかどうか
    - `LoadDefaultSettings()`:
      - 説明: デフォルトの設定値を読み込む。（プライベートメソッド）
      - 引数: なし
      - 戻り値: なし
    - `LoadConfigurationFromFile()`:
      - 説明: 設定ファイルから設定を読み込む。（プライベートメソッド）
      - 引数: なし
      - 戻り値: なし
    - `SaveConfigurationToFile()`:
      - 説明: 設定ファイルに設定を保存する。（プライベートメソッド）
      - 引数: なし
      - 戻り値: なし
    - `GetConfigFilePath()`:
      - 説明: 設定ファイルのパスを取得する。（プライベートメソッド）
      - 引数: なし
      - 戻り値: String, 設定ファイルのパス
    - `SaveChanges()`:
      - 説明: 変更された設定を保存する。
      - 引数: なし
      - 戻り値: なし
    - `GetCurrentCallStack()`:
      - 説明: 現在のコールスタックを取得する。（プライベートメソッド）
      - 引数: なし
      - 戻り値: String, コールスタック
    - `IDatabaseConfig_GetConnectionString()`:
      - 説明: データベース接続文字列を取得する。
      - 引数: なし
      - 戻り値: String, データベース接続文字列
- **その他特記事項**:
    - `CONFIG_FILE_PATH` 定数で設定ファイルのパスを指定する。
    - `MAX_BUFFER_SIZE` 定数で設定値の最大バッファサイズを指定する。
    - `DEFAULT_SECTION` 定数でデフォルトのセクション名を指定する。
    - `ConfigurationSettings` 型変数 `settings` に設定値を保持する。
    - `AutoSave` プロパティで設定変更時に自動的に保存するかどうかを制御する。
    - `HasUnsavedChanges` プロパティで未保存の変更があるかどうかを確認できる。
    - テスト用の `ResetModule` および `ValidateSettings` メソッドを持つ（DEBUG時のみ）。

### 18. modError

- **概要**: エラー処理機能を提供するモジュール。エラーハンドラーの呼び出し、エラー情報の補完、緊急ログ出力などを行う。
- **依存関係**:
    - IErrorHandler
    - clsLock
    - clsPerformanceMonitor
    - DatabaseConnectionErrorHandler
    - FileNotFoundErrorHandler
    - InvalidInputErrorHandler
    - ErrorInfo
    - modErrorCodes
    - modStackTrace
    - modWindowsAPI
- **メソッド**:
    - `InitializeModule()`:
      - 説明: モジュールを初期化する。
      - 引数: なし
      - 戻り値: なし
    - `TerminateModule()`:
      - 説明: モジュールを終了処理する。
      - 引数: なし
      - 戻り値: なし
    - `TryHandleError(ByRef context As ErrorContext)`:
      - 説明: エラー処理を試行する。（プライベートメソッド）
      - 引数:
        - `context`: ErrorContext, エラー処理のコンテキスト
      - 戻り値: Boolean, エラー処理に成功したかどうか
    - `HandleError(ByRef errInfo As ErrorInfo)`:
      - 説明: エラーを処理する。
      - 引数:
        - `errInfo`: ErrorInfo, エラー情報
      - 戻り値: なし
    - `RegisterDefaultHandlers()`:
      - 説明: デフォルトのエラーハンドラーを登録する。（プライベートメソッド）
      - 引数: なし
      - 戻り値: なし
    - `GetErrorHandler(errorCode As ErrorCode)`:
      - 説明: エラーコードに対応するエラーハンドラーを取得する。（プライベートメソッド）
      - 引数:
        - `errorCode`: ErrorCode, エラーコード
      - 戻り値: IErrorHandler, エラーハンドラー
    - `GetDefaultHandlerForCategory(category As ErrorCodeCategory)`:
      - 説明: エラーカテゴリに対応するデフォルトのエラーハンドラーを取得する。（プライベートメソッド）
      - 引数:
        - `category`: ErrorCodeCategory, エラーカテゴリ
      - 戻り値: IErrorHandler, デフォルトのエラーハンドラー
    - `RegisterErrorHandler(errorCode As ErrorCode, handler As IErrorHandler)`:
      - 説明: エラーハンドラーを登録する。
      - 引数:
        - `errorCode`: ErrorCode, エラーコード
        - `handler`: IErrorHandler, エラーハンドラー
      - 戻り値: なし
    - `UnregisterErrorHandler(errorCode As ErrorCode)`:
      - 説明: エラーハンドラーの登録を解除する。
      - 引数:
        - `errorCode`: ErrorCode, エラーコード
      - 戻り値: なし
    - `EmergencyErrorLog(message As String)`:
      - 説明: 緊急エラーをログに記録する。（プライベートメソッド）
      - 引数:
        - `message`: String, エラーメッセージ
      - 戻り値: なし
    - `WriteToEventLog(message As String)`:
      - 説明: イベントログに書き込む。（プライベートメソッド）
      - 引数:
        - `message`: String, メッセージ
      - 戻り値: なし
    - `WriteToEmergencyFile(message As String)`:
      - 説明: 緊急用ファイルに書き込む。（プライベートメソッド）
      - 引数:
        - `message`: String, メッセージ
      - 戻り値: なし
- **その他特記事項**:
    - `MAX_ERROR_RECURSION` 定数でエラー処理の再帰呼び出しの上限回数を設定する。
    - `ErrorContext` 型変数 `context` にエラー処理に必要な情報を格納する。
    - テスト用の `TestErrorHandling`, `TestErrorRecursion`, `TestResourceManagement`, `GetPerformanceReport`, `GetRegisteredHandlerCount`, `ClearHandlers`, `ResetModule`, `GetActiveLockCount` メソッドを持つ（DEBUG時のみ）。

### 19. modErrorCodes

- **概要**: エラーコードとエラーカテゴリを定義するモジュール。
- **依存関係**: なし
- **メソッド**:
    - `GetErrorCategory(errCode As ErrorCode)`:
      - 説明: エラーコードに対応するエラーカテゴリを取得する。
      - 引数:
        - `errCode`: ErrorCode, エラーコード
      - 戻り値: ErrorCodeCategory, エラーカテゴリ
- **その他特記事項**:
    - `ErrorCodeCategory` 列挙型でエラーカテゴリを定義する。
    - `ErrorCode` 列挙型でエラーコードを定義する。

### 20. PerformanceCounterImpl

- **概要**: パフォーマンスカウンターへのアクセスを提供するクラス。
- **依存関係**:
    - IPerformanceCounter
    - clsLock
    - modWindowsAPI
    - ErrorInfo
    - modError
    - modStackTrace
- **メソッド**:
    - `IPerformanceCounter_QueryPerformanceCounter(ByRef performanceCount As Currency)`:
      - 説明: パフォーマンスカウンターの値を取得する。
      - 引数:
        - `performanceCount`: Currency, パフォーマンスカウンターの値（出力用）
      - 戻り値: Boolean, 取得に成功したかどうか
    - `IPerformanceCounter_QueryPerformanceFrequency(ByRef frequency As Currency)`:
      - 説明: パフォーマンスカウンターの周波数を取得する。
      - 引数:
        - `frequency`: Currency, パフォーマンスカウンターの周波数（出力用）
      - 戻り値: Boolean, 取得に成功したかどうか
    - `CheckHighResolutionSupport()`:
      - 説明: 高分解能タイマーがサポートされているかどうかを確認する。（プライベートメソッド）
      - 引数: なし
      - 戻り値: Boolean, 高分解能タイマーがサポートされているかどうか
    - `LogError(message As String)`:
      - 説明: エラーをログに記録する。（プライベートメソッド）
      - 引数:
        - `message`: String, エラーメッセージ
      - 戻り値: なし
    - `GetResolution()`:
      - 説明: パフォーマンスカウンターの分解能を取得する。
      - 引数: なし
      - 戻り値: Double, 分解能（秒単位）
- **その他特記事項**:
    - 高分解能タイマーがサポートされている場合、`mIsHighResolutionSupported` が `True` に設定される。
    - パフォーマンスカウンターの周波数は `mFrequency` にキャッシュされる。
    - テスト用の `ValidateState`, `GetFrequency`, `IsHighResolutionSupported`, `TestTimerConsistency` メソッドを持つ（DEBUG時のみ）。

### 21. PerformanceMonitorImpl

- **概要**: パフォーマンス測定機能を提供するクラス。
- **依存関係**:
    - IPerformanceMonitor
    - modWindowsAPI
    - clsLock
    - IAppConfig
    - modConfig
    - ErrorInfo
    - modError
    - modStackTrace
- **メソッド**:
    - `IPerformanceMonitor_Start(measurementName As String)`:
      - 説明: パフォーマンス測定を開始する。
      - 引数:
        - `measurementName`: String, 測定名
        - 戻り値: なし
      - `IPerformanceMonitor_Stop(measurementName As String)`:
        - 説明: パフォーマンス測定を終了する。
        - 引数:
          - `measurementName`: String, 測定名
        - 戻り値: なし
      - `IPerformanceMonitor_GetMeasurement(measurementName As String)`:
        - 説明: 指定された測定の経過時間（ミリ秒）を取得する。
        - 引数:
          - `measurementName`: String, 測定名
        - 戻り値: Double, 経過時間（ミリ秒）
      - `IPerformanceMonitor_GetAllMeasurements()`:
        - 説明: すべての測定の経過時間（ミリ秒）を取得する。
        - 引数: なし
        - 戻り値: Variant, 各測定の経過時間（ミリ秒）を格納した配列
      - `IPerformanceMonitor_Clear()`:
        - 説明: すべての測定をクリアする。
        - 引数: なし
        - 戻り値: なし
      - `IPerformanceMonitor_IsEnabled()`:
        - 説明: パフォーマンス監視が有効かどうかを取得する。
        - 引数: なし
        - 戻り値: Boolean, パフォーマンス監視が有効かどうか
      - `IPerformanceMonitor_Enable()`:
        - 説明: パフォーマンス監視を有効にする。
        - 引数: なし
        - 戻り値: なし
      - `IPerformanceMonitor_Disable()`:
        - 説明: パフォーマンス監視を無効にする。
        - 引数: なし
        - 戻り値: なし
      - `GetDetailedMeasurement(measurementName As String)`:
        - 説明: 指定された測定の詳細なレポートを取得する。
        - 引数:
          - `measurementName`: String, 測定名
        - 戻り値: String, 詳細なレポート
  - **その他特記事項**:
      - `mFrequency` メンバー変数にパフォーマンスカウンターの周波数を保持する。
      - `mMeasurements` コレクションに測定データを格納する。
      - `mIsEnabled` メンバー変数でパフォーマンス監視の有効/無効を管理する。
      - `mCurrentOperation` メンバー変数に現在実行中の操作名を格納する。
      - `PROCESS_MEMORY_COUNTERS` 型を使用して、プロセスのメモリ使用量を取得する。
      - テスト用の `ValidatePerformanceCounter`, `GetMeasurementCount`, `SimulateMeasurement`, `CurrentOperation` メソッド/プロパティを持つ（DEBUG時のみ）。
